#! /:/bin/rpm
#
#  File: libwhat.spec
#  $Id: WHAT.spec.in,v 1.14 2002/06/06 07:27:52 eric Exp $
#
#  This is the SPEC file for the What CORE
#  Anakeen What Application
#

%define apachedir /etc/httpd
%define destdir /home/httpd/what

Summary: What Hosting Application Toolkit
Name: @PACKAGE@
Version: @VERSION@
Release: @RELEASE@
Copyright: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
# post-2.2.0 fix (can go away with next release):
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Yannick Le Briquer <yannick.lebriquer@anakeen.com>
BuildArchitectures: noarch
BuildRoot: /tmp/anakeen-root
Conflicts: AUTHENT USERS CORE APPMNG ACCESS libwhat libjs
Requires: php >= 4.0.5
Requires: apache
Requires: postgresql >= 7.2
Requires: php-pgsql
Requires: php-gettext
Requires: php-pcre
Requires: php-shell
Requires: php-mhash
Prereq: ankpsql-tools
Prereq: php-shell
Prereq: apache
Prereq: grep
Prereq: anakeen-post-install
Prereq: SysVinit
Prereq: gettext

%description
The WHAT application toolkit gives common interface element to develop web applications


%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure --with-pubrule=`pwd`
make pubdir=$RPM_BUILD_ROOT%{destdir} 

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post

if [ "$1" = 1 ] ; then

  # Add apache options for what
  echo "Include %{destdir}/apache.conf" >>/etc/httpd/conf/httpd.conf

  # Restart Apache if running
  run=`/etc/rc.d/init.d/httpd status |grep pid|wc -l`
  if [ $run = 1 ] ; then
     /etc/rc.d/init.d/httpd restart
  fi

else   

  # just update
  echo
fi
%{destdir}/wstop


%preun


%postun



%files
%defattr(-,root,root)
%dir %{destdir}
%doc ChangeLog
%{destdir}/*

%changelog
* Tue Oct 30 2000 Yannick Le Briquer <yannick.lebriquer@anakeen.com>
- Build first RPM

