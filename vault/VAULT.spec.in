#! /bin/rpm
#
#  File: libwhat.spec
#  $Id: VAULT.spec.in,v 1.14 2006/12/22 09:33:43 eric Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define cerbere         %(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'none' && echo 1 || echo 0)
%define pld		%(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'PLD' && echo 1 || echo 0)
%define redhat	        %(rpm -q --queryformat '%{VENDOR}' rpm | grep -q 'Red Hat, Inc.' && echo 1 || echo 0)
%if %{cerbere}
%define destdir /home/httpd/what
%define httpuser http
%define releasepostfix %(echo)
%endif
%if %{pld}
%define destdir /usr/share/what
%define httpuser http
%define releasepostfix cb
%endif
%if %{redhat}
%define destdir /usr/share/what
%define httpuser apache
%define releasepostfix fc%(cat /etc/fedora-release | sed -e 's/.* release \\([[:digit:]]\\+\\) .*/\\1/')
%endif

Summary: The What Vault Management
Name: @PACKAGE@
Version: @VERSION@
Release: @RELEASE@%{releasepostfix}
License: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
# post-2.2.0 fix (can go away with next release):
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Marc Claverie <marc.claverie@anakeen.com>
BuildArchitectures: noarch
BuildRoot: %{_tmppath}/%{name}-%{version}-root-%(id -u -n)
Requires: php >= 4.0.5
%if %{cerbere} || %{pld}
Requires: apache >= 1.3.12
%else
Requires: httpd >= 1.3.12
%endif
Requires: postgresql >= 7.0.0
Requires: php-pgsql >= 4.0.2
Prereq: WHAT >= 0.1.0
%if %{cerbere} || %{pld}
Prereq: php-cgi >= 4.0.2
%endif
Prereq: gettext

%description
Vault is a storage file system.


%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure  --with-pubrule=`pwd` \
	     --prefix=%{destdir}
make pubdir=$RPM_BUILD_ROOT%{destdir}

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post
%{destdir}/wstop
  mkdir -p /var/log/what-vault
%if %{cerbere} || %{pld}
  chown http: /var/log/what-vault
%else
  chown apache: /var/log/what-vault
%endif
  cat <<EOF > /etc/logrotate.d/what-vault
/var/log/what-vault/*.log {
  weekly
  rotate 4
  compress
}
EOF


%preun

%files
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/%{name}
%{destdir}/%{name}/*
%{destdir}/locale/*


%changelog
* Tue Oct 30 2000 Yannick Le Briquer <yannick.lebriquer@anakeen.com>
- Build first RPM

