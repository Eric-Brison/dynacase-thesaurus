#! /bin/rpm
#
#  File: libwhat.spec
#  $Id: FREEDOM.spec.in,v 1.88 2005/11/17 13:29:38 eric Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define cerbere         %(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'none' && echo 1 || echo 0)

%if %{cerbere}
%define destdir /home/httpd/what
%define httpuser http
%else
%define destdir /usr/share/what
%define httpuser apache
%endif

Summary: The Freedom Management Module
Name: @PACKAGE@
Version: @VERSION@
%if %{cerbere}
Release: @RELEASE@
%else
Release: @RELEASE@fc
%endif
License: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
# post-2.2.0 fix (can go away with next release):
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Yannick Le Briquer <yannick.lebriquer@anakeen.com>
BuildArchitectures: noarch
BuildRoot: %{_tmppath}/%{name}-%{version}-root-%(id -u -n)
PreReq: @PACKAGE@-LIB = %{version}
Requires: @PACKAGE@-USERCARD
%description
The FREEDOM (Free Document Object Model) module is use to manage document in intranet


%package LIB
Summary: libraries of FREEDOM module
Group: Applications/Web
Requires: php >= 5.0
Requires: php-gd
%if %{cerbere}
Requires: php-calendar
%else
Requires: metamail >= 2.7
%endif
Requires: postgresql >= 8.0
Requires: html2ps
Requires: ghostscript
%if %{cerbere}
Requires: ghostscript-fonts-std
%else
Requires: ghostscript-fonts
%endif
Requires: libjpeg-devel
Requires: netpbm
Requires: netpbm-progs
Requires: php-xml
Requires: tar
Requires: unzip
Requires: bzip2
PreReq: vixie-cron
PreReq: WHAT >= 2.1.0
Prereq: VAULT >= 2.0.0
Prereq: gettext
%if %{cerbere}
Prereq: php-cgi 
%else
Prereq: php
%endif
Conflicts: ROAMING < 0.0.5
Conflicts: AFFMON < 0.2.5

%description LIB
The FREEDOM LIBS is necessary to use functionnality of the FREEDOM module

%package USERCARD
Summary: user card management
Group: Applications/Web
Requires: php-ldap
%if %{cerbere}
Requires: openldap-servers
Requires: openldap-backend-ldbm
%else
Requires: openldap-servers
%endif
PreReq: WHAT
PreReq: @PACKAGE@-LIB = %{version}
PreReq: @PACKAGE@ = %{version}

%description USERCARD
The user card module allow to view & edit user card and to insert them in a LDAP server



%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure  --with-pubrule=`pwd` \
	     --with-httpuser=%{httpuser} \
	     --prefix=%{destdir}
make  pubdir=$RPM_BUILD_ROOT%{destdir}
ln -s editbodycard.xml $RPM_BUILD_ROOT/%{destdir}/FDL/Layout/editoptcard.xml
ln -s viewbodycard.xml $RPM_BUILD_ROOT/%{destdir}/FDL/Layout/viewoptcard.xml
[ ! -d $RPM_BUILD_ROOT/%{destdir}/htmlarea/htmlarea ] && mkdir $RPM_BUILD_ROOT/%{destdir}/htmlarea/htmlarea
cd $RPM_BUILD_ROOT/%{destdir}/htmlarea/htmlarea
ln -sf ../images .
ln -sf ../popups .
cd - > /dev/null

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post 
%{destdir}/wstop

%preun


%post USERCARD
%{destdir}/wstop

%preun USERCARD




%post LIB
%{destdir}/wstop


%preun LIB


%files
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/%{name}
%{destdir}/%{name}/*
%dir %{destdir}/ONEFAM
%{destdir}/ONEFAM/*

%files USERCARD
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/USERCARD
%dir %{destdir}/FUSERS
%{destdir}/USERCARD/*
%{destdir}/FUSERS/*


%files LIB
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/FDLGEN
%dir %{destdir}/FDL
%dir %{destdir}/GENERIC
%{destdir}/FDL/*
%{destdir}/GENERIC/*
%{destdir}/locale/*
%{destdir}/API/*
%dir %{destdir}/EXTERNALS
%{destdir}/EXTERNALS/*
%{destdir}/htmlarea/*
%{destdir}/jscalendar/*
%{destdir}/jsXMLParser/*
%{destdir}/mcal/*


%attr(700,root,root) /etc/cron.daily/FREEDOM.cron

%changelog
* Tue Oct 30 2000 Yannick Le Briquer <yannick.lebriquer@anakeen.com>
- Build first RPM

