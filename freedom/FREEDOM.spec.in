#
#  File: libwhat.spec
#  $Id: FREEDOM.spec.in,v 1.4 2002/01/04 15:45:54 eric Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define apachedir /etc/httpd
%define destdir /home/httpd/what

Summary: The What Users Management Module
Name: @PACKAGE@
Version: @VERSION@
Release: @RELEASE@
Copyright: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
# post-2.2.0 fix (can go away with next release):
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Yannick Le Briquer <yannick.lebriquer@anakeen.com>
BuildArchitectures: noarch
BuildRoot: /tmp/anakeen-root
Requires: php >= 4.0.5
Requires: apache >= 1.3.12
Requires: postgresql >= 7.0.0
Requires: php-pgsql >= 4.0.2
Requires: libwhat >= 0.4.9
Requires: libjs >= 0.2.4
Prereq: CORE >= 0.4.7
Prereq: php-shell >= 4.0.2
Prereq: gettext

%description
The Contact module is use to save various information in cards


%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure  --with-pubrule=`pwd`
make pubdir=$RPM_BUILD_ROOT%{destdir}

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post
if [ "$1" = 1 ] ; then
  echo "Create @DBNAME@ database"
  su - postgres -c "createdb @DBNAME@" 2>&1 >>/dev/null
  echo "Create @DBUSER@ database  user"
  su - postgres -c "createuser -d -a @DBUSER@" 2>&1 >>/dev/null
  echo "Initiate Database elements"
  cd /home/httpd/what
  echo '<?
  include_once("Class.Application.php");
  $Null = "";
  $app=new Application();
  $app->Set("@PACKAGE@",$Null);  
  ?>' | /usr/bin/php -q 2>&1 >>/dev/null
  %{destdir}/CORE/wsh.php @PACKAGE@ @PACKAGE@_INIT 
else
  echo "Update Database elements"
  cd /home/httpd/what
  echo '<?
  include_once("Class.Application.php");
  $app=new Application();
  $Null = "";
  $app->Set("@PACKAGE@",$Null);
  $app->Update();
  ?>' | /usr/bin/php -q 2>&1 >>/dev/null
fi
# merge @PACKAGE@ translation for i18n
for lang in en fr ; do
    pushd /home/httpd/what/locale/$lang/LC_MESSAGES >/dev/null
    msgunfmt --force-po @PACKAGE@.mo -o @PACKAGE@.po
    msgunfmt --force-po what.mo -o what.po
    msgfmt what.po @PACKAGE@.po -o what.mo
    rm -f *.po
    popd >/dev/null
done

%preun
if [ "$1" = 0 ] ; then
  echo "Remove Database elements"
  cd /home/httpd/what
  echo '<?
  include_once("Class.Application.php");
  $app=new Application();
  $Null = "";
  $app->Set("@PACKAGE@",$Null);
  $app->DeleteApp();
  ?>' | /usr/bin/php 2>&1 >>/dev/nul
fi

%files
%defattr(-,root,root)
%dir %{destdir}/%{name}
%{destdir}/%{name}/*
%{destdir}/locale/*


%changelog
* Tue Oct 30 2000 Yannick Le Briquer <yannick.lebriquer@anakeen.com>
- Build first RPM

