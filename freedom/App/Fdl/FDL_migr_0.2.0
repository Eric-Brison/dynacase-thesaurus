#!/bin/bash

 

pubdir="/home/httpd/what";

/usr/bin/php -q $pubdir/API/updateclass.php --dbname=freedom --appc=FDL --class=DocAttr
psql freedom anakeen -f $pubdir/FDL/FDL_migr_0.2.0.sql
/usr/bin/php -q $pubdir/API/updateclass.php --dbname=freedom --appc=FDL --class=Doc




$pubdir/wsh.php --api=migr_sql2.0 | psql freedom anakeen
echo "update  docfam set cprofid =  docfamtemp.cprofid from docfamtemp where docfamtemp.id=docfam.id;"| psql freedom anakeen
echo "update  docfam set dfldid =  docfamtemp.dfldid from docfamtemp where docfamtemp.id=docfam.id;"| psql freedom anakeen


echo "CREATE UNIQUE INDEX idx_idfam ON docfam(id);" | psql freedom anakeen

/usr/bin/php -q $pubdir/API/updateclass.php --dbname=freedom --appc=FDL --class=DocValue

echo "update doc set classname='' where doctype != 'C'; update docfam set classname='Doc'||fromid where id > 6 and fromid > 0;" | psql freedom anakeen


/usr/bin/php -q $pubdir/API/updateclass.php --dbname=freedom --appc=FDL --class=DocFam
echo "VACUUM FULL ANALYZE;" | psql freedom anakeen

$pubdir/wsh.php --api=fdl_adoc 
$pubdir/wsh.php --api=fdl_trigger  | psql freedom anakeen
$pubdir/wsh.php --api=fdl_trigger --trigger=yes | psql freedom anakeen

echo "update docvalue set attrid=lower(attrid);" | psql freedom anakeen
echo "update docattr set id=lower(id);" | psql freedom anakeen
echo "update docattr set frameid=lower(frameid);" | psql freedom anakeen
