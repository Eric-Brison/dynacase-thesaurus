<?php


include_once("FDL/Class.[DocParent].php");
[include]
Class ADoc[docid] extends [AParent] {
    // for familly : [title]

   function ADoc[docid] () {
      [AParent]::[AParent]();

     [BLOCK MATTR]
     $this->attr["[attrid]"]=new MenuAttribute("[attrid]","[label]",[order],"[link]","[precond]");
    
     [ENDBLOCK MATTR]
     [BLOCK FATTR]
     $this->attr["[attrid]"]=new FieldSetAttribute("[attrid]","[label]");

     [ENDBLOCK FATTR]
     [BLOCK NATTR]
     $this->attr["[attrid]"]=new NormalAttribute("[attrid]","[label]","[type]",[order],"[link]",
                                                "[visibility]",[needed],[title],[abstract],
						$this->attr["[frame]"],"[phpfile]","[phpfunc]","[elink]");

     [ENDBLOCK NATTR]
     $this->fromids[[docid]]=[docid];
[BLOCK ATTRFIELD]
    $this->fields["[attrid]"]="[attrid]";[ENDBLOCK ATTRFIELD]
   }
}

Class Doc[docid] extends [DocParent] {
   //  familly : [title]

   var $dbtable="doc[docid]";
   var $sqlcreate = "
     create table doc[docid] ([sattr]) inherits (doc[fromid]);
     create unique index doc_pkey[docid] on doc[docid](id);      
     CREATE OR REPLACE FUNCTION upval[docid]() RETURNS OPAQUE AS '
declare 
begin
[BLOCK ATTRFIELD2]
  delete from docvalue where docid=NEW.id and attrid=''[attrid]'';
  if not NEW.[attrid] isnull then insert into docvalue (docid, attrid, value) VALUES (NEW.id, ''[attrid]'', NEW.[attrid]);end if;[ENDBLOCK ATTRFIELD2]
  return NEW;
end;
' LANGUAGE 'plpgsql'; ";

     var $fromid=[docid];

   function Doc[docid] ($dbaccess='', $id='',$res='',$dbid=0) {
    $this->attributes = new ADoc[docid]();
    
    if (isset($this->attributes->fields))  $this->fields += $this->attributes->fields;

      DbObjCtrl::DbObjCtrl($dbaccess, $id, $res, $dbid);

    

      uasort($this->attributes->attr,"tordered"); 
       
   }

   [METHODS]

}
?>
