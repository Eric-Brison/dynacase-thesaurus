#! /bin/rpm
#
#  File: 
#  $Id: FREEDOM-DAV.spec.in,v 1.6 2006/11/23 09:36:06 eric Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define cerbere         %(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'none' && echo 1 || echo 0)
%define pld		%(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'PLD' && echo 1 || echo 0)
%define redhat	        %(rpm -q --queryformat '%{VENDOR}' rpm | grep -q 'Red Hat, Inc.' && echo 1 || echo 0)

%if %{cerbere}
%define destdir /home/httpd/what
%define httpuser http
%define releasepostfix %(echo)
%define apacheconfdir /etc/httpd/httpd.conf
%endif
%if %{pld}
%define destdir /usr/share/what
%define httpuser http
%define releasepostfix cb
%define apacheconfdir /etc/webapps/what
%endif
%if %{redhat}
%define destdir /usr/share/what
%define httpuser apache
%define releasepostfix fc5
%define apacheconfdir /etc/httpd/conf.d
%endif
%define dirname DAV

Summary: The Work Space to exchange files
Name: @PACKAGE@
Version: @VERSION@
Release: @RELEASE@%{releasepostfix}
License: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
# post-2.2.0 fix (can go away with next release):
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Yannick Le Briquer <yannick.lebriquer@anakeen.com>
BuildArchitectures: noarch
BuildRoot: /tmp/anakeen-root
Requires: FREEDOM-LIB >= 2.5.0
%if %{pld}
Requires: php-ctype
Requires: apache-mod_rewrite
#Requires: php-pear-HTTP_WebDAV_Server
%endif
Prereq: WHAT 
Prereq: php-cgi 
Prereq: gettext


%description
The FREEDOM DAV module install a WebDAV server which can browse files of FREEDOM. 




%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure --with-pubrule=`pwd`
make  pubdir=$RPM_BUILD_ROOT%{destdir} 
install -d $RPM_BUILD_ROOT/%{destdir}/dav
cd $RPM_BUILD_ROOT/%{destdir}/dav
ln -s ../%{dirname}/dav.php  zou679__e.php
install -d $RPM_BUILD_ROOT%{apacheconfdir}
%if %{cerbere}
install $RPM_BUILD_ROOT/%{destdir}/%{dirname}/DAV_conf.apache $RPM_BUILD_ROOT/%{apacheconfdir}/72_mod_dav.conf.template
%else
  %if %{pld} 
    install $RPM_BUILD_ROOT/%{destdir}/%{dirname}/DAV_conf.apache $RPM_BUILD_ROOT/%{apacheconfdir}/72_mod_dav.conf.template
  %else
    install $RPM_BUILD_ROOT/%{destdir}/%{dirname}/DAV_conf.apache $RPM_BUILD_ROOT/%{apacheconfdir}/72_mod_dav.conf.template
  %endif
%endif
%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post
%{destdir}/wstop




%preun
%postun
%{destdir}/wstop



%files
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/%{dirname}
%{destdir}/%{dirname}/*
%{destdir}/dav/*
%{destdir}/locale/*
%{apacheconfdir}/72_mod_dav.conf.template


%changelog
* Tue Oct 30 2000 Yannick Le Briquer <yannick.lebriquer@anakeen.com>
- Build first RPM

