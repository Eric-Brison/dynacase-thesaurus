#! /bin/rpm
#
#  File: 
#  $Id: FREEEVENT.spec.in,v 1.11 2006/08/04 10:25:11 eric Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define apachedir /etc/httpd
%define cerbere         %(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'none' && echo 1 || echo 0)
%define pld		%(uname -o | grep -c PLD)

%if %{cerbere}
%define destdir /home/httpd/what
%define httpuser http
%else
%if %{pld}
%define destdir /usr/share/what
%define httpuser http
%else
%define destdir /usr/share/what
%define httpuser apache
%endif
%endif


Summary: The Freedom Event Package
Name: @PACKAGE@
Version: @VERSION@
%if %{cerbere} || %{pld}
Release: @RELEASE@
%else
Release: @RELEASE@fc
%endif
License: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Eric Brison <eric.brison@anakeen.com>
BuildArchitectures: noarch
BuildRoot: /tmp/anakeen-root
Requires: FREEDOM-LIB >= 2.3.2
Requires: WHAT >= 2.0.0

%description
This package offers the freedom engine to process events


%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure --with-pubrule=`pwd`\
	     --with-httpuser=%{httpuser} \
	     --prefix=%{destdir}
make  pubdir=$RPM_BUILD_ROOT%{destdir} 
install -d $RPM_BUILD_ROOT/%{destdir}/FDL
cd $RPM_BUILD_ROOT/%{destdir}/FDL
ln -s ../FREEEVENT/Method*.php  .
cd -
%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post
%{destdir}/wstop




%preun
%postun




%files
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/%{name}
%{destdir}/%{name}/*
%{destdir}/EXTERNALS
%{destdir}/locale/*
%{destdir}/FDL/Method*



%changelog
* Thu Nov 23 2004 Eric Brison <eric.brison@anakeen.com>
- Build first RPM

