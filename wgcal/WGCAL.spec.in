#! /bin/rpm
#
#  File: 
#  $Id: WGCAL.spec.in,v 1.21 2005/09/21 16:44:31 marc Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define destdir /home/httpd/what

Summary: The Freedom Workgroup Calendar
Name: @PACKAGE@
Version: @VERSION@
Release: @RELEASE@
License: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Marc Claverie <marc.claverie@anakeen.com>
BuildArchitectures: noarch
BuildRoot: /tmp/anakeen-root
Requires: FREEEVENT >= 2.0.0
Requires: FREEDOM-LIB >= 2.0.0

%description
The Freedom Workgroup Calendar


%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure --with-pubrule=`pwd`
make  pubdir=$RPM_BUILD_ROOT%{destdir} 
install -d $RPM_BUILD_ROOT/etc/httpd/httpd.conf
install  $RPM_BUILD_ROOT/%{destdir}/%{name}/73_mod_wgcalosync.conf $RPM_BUILD_ROOT/etc/httpd/httpd.conf/73_mod_wgcalosync.conf


%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post
%{destdir}/wstop
cd %{destdir}/FDL
ln -sf ../@PACKAGE@/Class*php .
ln -sf ../@PACKAGE@/Method*php .
cd %{destdir}/EXTERNALS
ln -sf ../@PACKAGE@/*external.php .
cd %{destdir}/API
ln -sf ../@PACKAGE@/wgcal_alert.php .
cd -




%preun
%postun
%{destdir}/wstop



%files

%defattr(-,root,root)

%dir %{destdir}/%{name}
%{destdir}/%{name}/*

%dir %{destdir}/osync
%{destdir}/osync/*

%{destdir}/EXTERNALS/*

%{destdir}/API/*

%{destdir}/locale/*

%attr(640,root,root) %config(noreplace) %verify(not size mtime md5) /etc/httpd/httpd.conf/73_mod_wgcalosync.conf

/home/httpd/what/API/migr_wcal_to_ngcal.php
   /home/httpd/what/API/migrcal1.sql
   /home/httpd/what/API/migrcal2.sql
   /home/httpd/what/API/migrcal3.sql



%changelog
* Thu Nov 23 2004 Marc Claverie <marc.claverie@i-cesam.com>
- Build first RPM

