#! /bin/rpm
#
#  File: 
#  $Id: WGCAL.spec.in,v 1.37 2006/09/06 16:14:45 eric Exp $
#
#  This is the SPEC file for the What Users Module
#  Anakeen What Application
#

%define cerbere         %(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'none' && echo 1 || echo 0)
%define pld		%(rpm -q --queryformat '%{VENDOR}' rpm |grep -q 'PLD' && echo 1 || echo 0)
%define redhat	        %(rpm -q --queryformat '%{VENDOR}' rpm | grep -q 'Red Hat, Inc.' && echo 1 || echo 0)
%if %{cerbere}
%define destdir /home/httpd/what
%define httpuser http
%define apacheconfdir /etc/httpd/httpd.conf
%define releasepostfix %(echo)
%endif
%if %{pld}
%define destdir /usr/share/what
%define httpuser http
%define apacheconfdir /etc/webapps/what
%define releasepostfix cb
%endif
%if %{redhat}
%define destdir /usr/share/what
%define apacheconfdir /etc/httpd/conf.d
%define httpuser apache
%define releasepostfix fc5
%endif

Summary: The Freedom Workgroup Calendar
Name: @PACKAGE@
Version: @VERSION@
Release: @RELEASE@%{releasepostfix}
License: GPL
Group: Applications/Web
Source: ftp://ftp.souillac.anakeen.com/pub/anakeen/%{name}-%{version}.tar.gz
Vendor: Anakeen           
URL: http://www.anakeen.com/
Packager: Marc Claverie <marc.claverie@anakeen.com>
BuildArchitectures: noarch
BuildRoot: /tmp/anakeen-root
Requires: FREEEVENT >= 2.0.2
Requires: FREEDOM-LIB >= 2.3.1

%description
The Freedom Workgroup Calendar


%package SYNC
Summary: Synchro util for Outlook
Group: Applications/Web
Requires: @PACKAGE@ = %{version}

%description SYNC
Synchronise event calendar with Microsoft Outlook

%prep
%setup -q -n %{name}-%{version}

%build

%install
autoconf
./configure  --with-pubrule=`pwd` \
	     --with-httpuser=%{httpuser} \
	     --with-apacheconfdir=%{apacheconfdir} \
	     --prefix=%{destdir}
make  pubdir=$RPM_BUILD_ROOT%{destdir} 
install -d $RPM_BUILD_ROOT/%{apacheconfdir}
install  $RPM_BUILD_ROOT/%{destdir}/%{name}/73_mod_wgcalosync.conf $RPM_BUILD_ROOT/%{apacheconfdir}/73_mod_wgcalosync.conf
install -d $RPM_BUILD_ROOT/%{destdir}/FDL
cd $RPM_BUILD_ROOT/%{destdir}/FDL
ln -s ../@PACKAGE@/Method*.php  .
install -d $RPM_BUILD_ROOT/%{destdir}/EXTERNALS
cd $RPM_BUILD_ROOT/%{destdir}/EXTERNALS
ln -s ../@PACKAGE@/*external.php  .
install -d $RPM_BUILD_ROOT/%{destdir}/API
cd $RPM_BUILD_ROOT/%{destdir}/API
ln -s ../@PACKAGE@/wgcal_alert.php .


%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%post


%{destdir}/wstop





%preun
%postun



%files
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/%{name}
%{destdir}/%{name}/*
%{destdir}/locale/*
%{destdir}/API/*
%{destdir}/FDL/*
%{destdir}/EXTERNALS/*

%files SYNC
%defattr(-,%{httpuser},%{httpuser})
%dir %{destdir}/osync
%{destdir}/osync/*
%attr(640,root,root) %config(noreplace) %verify(not size mtime md5) %{apacheconfdir}/73_mod_wgcalosync.conf

%changelog
* Thu Nov 23 2004 Marc Claverie <marc.claverie@i-cesam.com>
- Build first RPM

