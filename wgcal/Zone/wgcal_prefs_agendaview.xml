<h4>[TEXT:confidentiality]</h4>

<fieldset><legend>[TEXT:event default confidentiality...]</legend>
[TEXT:default confidentiality for new event is set] <select onchange="changeUPref('[uid]','WGCAL_U_RVDEFCONF', this.options[this.selectedIndex].value, 'wgcal_hidden', 'WGCAL_HIDDEN'); if (this.options[this.selectedIndex].value == 2) document.getElementById('fshowgroups').style.display = ''; else document.getElementById('fshowgroups').style.display = 'none';">
[BLOCK evdefconf]<option value="[value]" [selected]>[descr]
[ENDBLOCK evdefconf]</select>

<fieldset id="fshowgroups" style="display:[fshowgroupsd]"><legend><img width="20px" height="20px" align="absbottom" src="[IMG:wgcal_choosegroups.gif]">&nbsp;[TEXT:my groups]</legend>
<div style="margin-left:20px; margin-right:20px; border:1px outset white">
[BLOCK groups]<div id="d[gfid]" style="margin:2px" class="[IF gisused]WGCRessSelected[ENDIF gisused][IFNOT gisused]WGCRessDefault[ENDIF gisused]" onmouseover="if (this.className!='WGCRessSelected') this.className='WGCRessOver'" 
onmouseout="if (this.className!='WGCRessSelected') this.className='WGCRessDefault'" title="[TEXT:click to selec/unselect group] [gtitle]" 
onclick="changeUserGrp([gfid])">&nbsp;&nbsp;<img src="[gicon]"  border="0" height="15px">&nbsp;&nbsp;[gtitle]</div>[ENDBLOCK groups]
</div>
</fieldset>

</fieldset>

[IF showvcal]<fieldset><legend>[TEXT:my agenda is visible by...]</legend>

<input type="radio" id="gall" name="gall" value="0" onchange="changeCalGrpVis(this)" [IF allsel]checked[ENDIF allsel]>[TEXT:all groups]<br>
[IF showgroups]
<input type="radio" id="gall" name="gall" value="1" onchange="changeCalGrpVis(this)" [IFNOT allsel]checked[ENDIF allsel]>[TEXT:only this groups]<br>
 
<div id="glistd" style="display:[vgroup]; margin-left:20px; margin-right:20px; border:1px outset white">
<table width="100%" border="0" style="padding:1em;" cellspacing="0">
[BLOCK cgroups]
<tr title="[TEXT:click to selec/unselect group] [gtitle]">
  <td align="left" 
      id="vcd[gfid]" 
      class="[IF gisused]WGCRessSelected[ENDIF gisused][IFNOT gisused]WGCRessDefault[ENDIF gisused]" 
      onmouseover="if (this.className!='WGCRessSelected') this.className='WGCRessOver'" 
      onmouseout="if (this.className!='WGCRessSelected') this.className='WGCRessDefault'" 
      align="center">&nbsp;&nbsp;<img src="[gicon]" border="0" height="15px">&nbsp;&nbsp;<input id="w[gfid]" style="visibility:[gwvisibility]" title="[TEXT:select to give write access / unselect for read only]" onclick="saveCalGrpList();" type="checkbox" value=[gwrite] [gwriteselected]>&nbsp;&nbsp;
      <span onclick="changeCalGrpList([gfid])">[gtitle]</span></td>
</tr>[ENDBLOCK cgroups]</table>
</div>
[ENDIF showgroups]
</fieldset>
[ENDIF showvcal]
<form id="vcalmodef" target="wgcal_hidden" method="POST" action="[CORE_STANDURL]&app=WGCAL&action=WGCAL_VCALMODE">
<input type="hidden" value="[vcalmode]"   id="vcalmode" name="vcalmode">
<input type="hidden" value="[vcalgroups]" id="vcalgroups" name="vcalgroups">
<input type="hidden" value="[vcalid]" id="vcalid" name="vcalid">
</form>
<form id="setugroups" target="wgcal_hidden" method="POST" action="[CORE_STANDURL]&app=WGCAL&action=WGCAL_SETUGROUPS"><input type="hidden" value="" id="ugroups" name="ugroups"></form>

<script type="text/javascript"> 

[BLOCK L_RESS]InsertPrefContact(-1, '[RDESCR]', '[RID]', '[RICON]', false);
[ENDBLOCK L_RESS]

var glist = new Array();
[BLOCK GLIST]glist[[igroup]] = [gfid];
[ENDBLOCK GLIST]
[IF GInit]InitGroups();[ENDIF GInit]

function countOfUserGrp() {
  var cug = 0;
  for (var i=0; i<glist.length;i++) {
    if (glist[i] != -1) cug++;
  }
  return cug;
}
  

function InitGroups() {
  var grpList = '';
  for (var i=0; i<glist.length;i++) {
    if (glist[i]!=-1) {
      var cGrp = document.getElementById('d'+glist[i]);
      cGrp.className = 'WGCRessSelected';
      grpList += glist[i]+'|';
    }
  }
  document.getElementById('ugroups').value = grpList;
  document.getElementById('setugroups').submit();
  return false;
}


function changeUserGrp(grp) {

  var grpList = '';
  var cGrp = document.getElementById('d'+grp);
  if (!cGrp) return;
  if (cGrp.className!='WGCRessSelected') {
    glist[glist.length] = grp;
    cGrp.className = 'WGCRessSelected';
  } else {
    if (countOfUserGrp()==1) {
      alert('[TEXT:you must have one group at least]');
      return false;
    }
    for (i=0; i<glist.length;i++) {
      if (glist[i] == grp) glist[i] = -1;
    }
    cGrp.className = 'WGCRessDefault';
  }
  
  for (i=0; i<glist.length;i++) {
    if (glist[i] != -1) {
      grpList += glist[i]+'|';
    }
  }
  document.getElementById('ugroups').value = grpList;
//   alert('liste des groupes : '+document.getElementById('ugroups').value);
  document.getElementById('setugroups').submit();
  return false;
}


var gclist = new Array();
[BLOCK GCLIST]gclist[[igroup]] = [gfid];[ENDBLOCK GCLIST]
[IF cginit]saveCalGrpList();[ENDIF cginit]

function countOfGrpVis() {
  var cug = 0;
  for (var i=0; i<gclist.length;i++) {
    if (gclist[i] != -1) cug++;
  }
  return cug;
}
function changeCalGrpVis(elt) {
  var glistd = document.getElementById('glistd');
  if (elt.value == 0) {
    glistd.style.display = 'none';
    document.getElementById('vcalmode').value = 0;
  }
  if (elt.value == 1) {
    glistd.style.display = '';
    document.getElementById('vcalmode').value = 1;
  }
  document.getElementById('vcalmodef').submit();
  return false;
}  

function changeCalGrpList(grp) {
  var cGrp = document.getElementById('vcd'+grp);
  var gmode = document.getElementById('w'+grp);
  if (!cGrp) return;
  if (cGrp.className!='WGCRessSelected') {
    gclist[gclist.length] = grp;
    cGrp.className = 'WGCRessSelected';
    gmode.checked = true;
    gmode.style.visibility = 'visible';
  } else {
    if (countOfGrpVis()==1) {
      alert('[TEXT:you must have one group at least]');
      return false;
    }
    for (i=0; i<gclist.length;i++) {
      if (gclist[i] == grp) gclist[i] = -1;
    }
    cGrp.className = 'WGCRessDefault';
    gmode.style.visibility = 'hidden';
  }
  saveCalGrpList();
  return false;
}

function saveCalGrpList() {
  var i;
  var grpList = '';
  for (i=0; i<gclist.length;i++) {
    if (gclist[i] != -1) {
      var mg = document.getElementById('w'+gclist[i]);
      if (mg.checked) vmg=1;
      else vmg = 0;
      grpList += gclist[i]+'%'+vmg+'|';
    }
  }
  document.getElementById('vcalgroups').value = grpList;
  document.getElementById('vcalmodef').submit();
}
			   
</script>
